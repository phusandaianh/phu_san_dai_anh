<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết cuộc hẹn - Phòng khám Phụ Sản Đại Anh</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="utilities.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo-container">
                <img src="logo_phu_san_dai_anh.PNG" alt="Logo Phòng khám Đại Anh" class="clinic-logo">
                <div class="logo-text">
                    <h1 class="logo">Phòng khám chuyên khoa Phụ Sản Đại Anh</h1>
                    <p class="slogan">Uy Tín - Chất Lượng</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="appointment-details">
            <h2>Chi tiết cuộc hẹn</h2>
            <div class="details-card">
                <div class="info-group">
                    <h3>Thông tin bệnh nhân</h3>
                    <p><strong>Họ tên:</strong> <span id="patient-name"></span></p>
                    <p><strong>Số điện thoại:</strong> <span id="patient-phone"></span></p>
                    <p><strong>Địa chỉ:</strong> <span id="patient-address"></span></p>
                    <p><strong>Ngày sinh:</strong> <span id="patient-dob"></span></p>
                </div>

                <div class="info-group">
                    <h3>Thông tin cuộc hẹn</h3>
                    <p><strong>Ngày hẹn:</strong> <span id="appointment-date"></span></p>
                    <p><strong>Dịch vụ:</strong> <span id="service-type"></span></p>
                    <p><strong>Trạng thái:</strong> <span id="appointment-status"></span></p>
                </div>

                <div class="info-group">
                    <h3>Kết quả khám</h3>
                    <p><strong>Chẩn đoán:</strong> <span id="diagnosis"></span></p>
                    <p><strong>Đơn thuốc:</strong> <span id="prescription"></span></p>
                </div>

                <div class="info-group">
                    <h3>Thanh toán</h3>
                    <p><strong>Tổng tiền:</strong> <span id="total-amount"></span></p>
                    <p><strong>Trạng thái thanh toán:</strong> <span id="payment-status"></span></p>
                    <button id="process-payment" class="btn primary-btn">Thanh toán</button>
                </div>

                <div class="action-buttons">
                    <button id="print-prescription" class="btn secondary-btn">
                        <i class="fas fa-print"></i> In đơn thuốc
                    </button>
                    <button id="print-ultrasound" class="btn secondary-btn">
                        <i class="fas fa-print"></i> In kết quả siêu âm
                    </button>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Phòng khám chuyên khoa Phụ Sản Đại Anh. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Load appointment details when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const appointmentId = urlParams.get('id');

            if (appointmentId) {
                try {
                    const response = await fetch(`/api/appointments/${appointmentId}`);
                    const appointment = await response.json();

                    // Update patient information
                    document.getElementById('patient-name').textContent = appointment.patient.name;
                    document.getElementById('patient-phone').textContent = appointment.patient.phone;
                    document.getElementById('patient-address').textContent = appointment.patient.address;
                    document.getElementById('patient-dob').textContent = new Date(appointment.patient.date_of_birth).toLocaleDateString('vi-VN');

                    // Update appointment information
                    document.getElementById('appointment-date').textContent = new Date(appointment.appointment_date).toLocaleString('vi-VN');
                    document.getElementById('service-type').textContent = appointment.service_type;
                    document.getElementById('appointment-status').textContent = appointment.status;

                    // Update medical information
                    if (appointment.medical_record) {
                        document.getElementById('diagnosis').textContent = appointment.medical_record.diagnosis;
                        document.getElementById('prescription').textContent = appointment.medical_record.prescription;
                    }

                    // Update payment information
                    document.getElementById('total-amount').textContent = new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(appointment.total_amount);
                    document.getElementById('payment-status').textContent = appointment.payment_status;

                    // Set appointment ID for print buttons
                    document.getElementById('print-prescription').dataset.appointmentId = appointmentId;
                    document.getElementById('print-ultrasound').dataset.appointmentId = appointmentId;

                    // Add payment button event listener
                    document.getElementById('process-payment').addEventListener('click', () => {
                        processPayment(appointmentId, appointment.total_amount);
                    });
                } catch (error) {
                    console.error('Error loading appointment details:', error);
                    alert('Không thể tải thông tin cuộc hẹn');
                }
            }
        });
    </script>
    
    <!-- AI Assistant - Luôn hiển thị trên mọi trang -->
    <script src="ai-assistant.js"></script>
    <script src="footer-loader.js"></script>
</body>
</html> 