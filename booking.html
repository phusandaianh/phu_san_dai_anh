<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch làm việc - Phòng khám Phụ Sản Đại Anh</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { background: #f8fafc; margin: 0; font-family: 'Roboto', Arial, sans-serif; }
        .header { background: #fff; box-shadow: 0 2px 8px rgba(44,62,80,0.04); }
        .header .container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            padding: 2rem 1rem 1.5rem 1rem;
        }
        .logo-text { text-align: left; }
        .logo { font-size: 1.5rem; color: #0000FF; margin: 0; font-weight: bold; }
        .slogan { margin: 0; font-size: 1rem; color: #888; }
        .work-schedule-section {
            max-width: 900px;
            margin: 2rem auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(33,150,243,0.08);
            padding: 2rem 1rem 2.5rem 1rem;
        }
        .work-schedule-title {
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 2rem;
            letter-spacing: 1px;
        }
        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        .schedule-card {
            background: #CCFFCC;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(33,150,243,0.07);
            padding: 1.2rem 1.2rem 1.2rem 1.2rem;
            display: flex;
            flex-direction: row;
            align-items: center;
            min-height: 120px;
            position: relative;
            gap: 1.2rem;
        }
        .schedule-card.today { border: 2px solid #e53935; }
        .schedule-card.tomorrow { border: 2px solid #ffb300; }
        .schedule-register {
            min-width: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .register-btn {
            background: #e53935;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.7rem 1.2rem;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 0.5rem;
        }
        .register-btn:hover {
            background: #b71c1c;
        }
        .schedule-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .schedule-date {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2196f3;
            margin-bottom: 0.3rem;
        }
        .schedule-status {
            font-size: 0.95rem;
            font-weight: bold;
            color: #e53935;
            margin-bottom: 0.5rem;
        }
        .schedule-status.tomorrow { color: #ff9800; }
        .schedule-time {
            font-size: 1.05rem;
            color: #388e3c;
            margin-bottom: 0.3rem;
        }
        .schedule-doctor {
            font-size: 1.05rem;
            color: #222;
        }
        @media (max-width: 600px) {
            .work-schedule-section { padding: 1rem 0.2rem; }
            .schedule-list { gap: 0.7rem; }
            .schedule-card { flex-direction: column; align-items: stretch; gap: 0.7rem; }
            .schedule-register { min-width: unset; flex-direction: row; justify-content: flex-start; }
        }
        .modal.hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <img src="logo_phu_san_dai_anh.png" alt="Logo Phòng khám Đại Anh" class="clinic-logo" style="height:60px;">
            <div class="logo-text">
                <h1 class="logo">Phòng khám chuyên khoa<br>Phụ Sản Đại Anh</h1>
                <p class="slogan">Uy Tín - Niềm Tin - Chất Lượng</p>
            </div>
        </div>
    </header>
    <section class="work-schedule-section">
        <div class="work-schedule-title">LỊCH LÀM VIỆC CỦA PHÒNG KHÁM</div>
        <div class="schedule-list" id="schedule-list"></div>
    </section>
    <!-- Popup đăng ký khám -->
    <div id="register-modal" class="modal hidden" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;z-index:1000;">
      <div class="modal-content" style="background:#fff;padding:2rem 1.5rem;border-radius:14px;min-width:320px;max-width:95vw;position:relative;">
        <button id="close-modal-btn" style="position:absolute;top:10px;right:10px;font-size:1.2rem;background:none;border:none;cursor:pointer;">&times;</button>
        <h2 style="margin-top:0">Đăng ký khám</h2>
        <form id="register-form">
          <div><b id="modal-date"></b></div>
          <div><b id="modal-time"></b></div>
          <div><b id="modal-doctor"></b></div>
          <div style="margin:10px 0 0 0;">
            <input type="text" id="patient-name" placeholder="Họ và tên" required style="width:100%;margin-bottom:8px;padding:7px;border-radius:6px;border:1px solid #ccc;">
            <input type="tel" id="patient-phone" placeholder="Số điện thoại" required style="width:100%;margin-bottom:8px;padding:7px;border-radius:6px;border:1px solid #ccc;">
            <div style="display:flex;gap:8px;margin-bottom:8px;">
              <select id="dob-day" required style="flex:1;padding:7px;border-radius:6px;border:1px solid #ccc;"></select>
              <select id="dob-month" required style="flex:1;padding:7px;border-radius:6px;border:1px solid #ccc;"></select>
              <select id="dob-year" required style="flex:1;padding:7px;border-radius:6px;border:1px solid #ccc;"></select>
            </div>
            <input type="text" id="patient-address" placeholder="Địa chỉ" required style="width:100%;margin-bottom:8px;padding:7px;border-radius:6px;border:1px solid #ccc;">
            <textarea id="patient-reason" placeholder="Lý do khám/Dịch vụ" rows="2" style="width:100%;margin-bottom:8px;padding:7px;border-radius:6px;border:1px solid #ccc;"></textarea>
          </div>
          <button type="submit" class="register-btn" style="width:100%;margin-top:8px;">Xác nhận đăng ký</button>
        </form>
      </div>
    </div>
    <div id="ws-copy-week-modal" class="modal hidden" ...>
    </div>
    <script>
    // Hàm lấy thứ tiếng Việt
    function getVietnameseDay(dateStr) {
      const d = new Date(dateStr);
      const days = ['Chủ nhật', 'Thứ hai', 'Thứ ba', 'Thứ tư', 'Thứ năm', 'Thứ sáu', 'Thứ bảy'];
      return days[d.getDay()];
    }
    // Hàm format ngày dd-mm-yyyy
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleDateString('vi-VN');
    }
    // Hàm so sánh giờ (hh:mm)
    function isPast(endTime, dateStr) {
      const now = new Date();
      const d = new Date(dateStr);
      if (now < d.setHours(0,0,0,0)) return false; // ngày tương lai
      const [h, m] = endTime.split(':');
      d.setHours(+h, +m, 0, 0);
      return now > d;
    }
    // Render lịch làm việc động
    async function renderSchedule() {
      const scheduleList = document.getElementById('schedule-list');
      scheduleList.innerHTML = '';
      const res = await fetch('/api/work-schedule');
      const data = await res.json();
      data.forEach(day => {
        const card = document.createElement('div');
        card.className = 'schedule-card';
        let html = `<div class='schedule-info'>
          <div class='schedule-date'>${getVietnameseDay(day.date)}, Ngày <span style="color:#1565c0;font-weight:bold;">${formatDate(day.date)}</span></div>`;
        if (!day.shifts.length) {
          html += `<div style='color:#e53935;font-weight:bold;margin-top:8px;'>Nghỉ</div>`;
        } else {
          day.shifts.forEach((shift, idx) => {
            const hetGio = isPast(shift.end_time, day.date);
            html += `<div style='margin:10px 0 0 0;padding:10px 0;border-top:1px dashed #b3e5fc;'>
              <div class='schedule-time'>Giờ khám: <b>${shift.start_time} đến ${shift.end_time}</b></div>
              <div class='schedule-doctor'>Bác sĩ khám: <b>${shift.doctor_name}</b></div>
              ${hetGio ? `<div style='color:#e53935;font-weight:bold;'>Hết giờ khám ca này</div>` : `<button class='register-btn' data-date='${day.date}' data-start='${shift.start_time}' data-end='${shift.end_time}' data-doctor='${shift.doctor_name}'>Đăng ký khám</button>`}
            </div>`;
          });
        }
        html += `</div>`;
        card.innerHTML = html;
        scheduleList.appendChild(card);
      });
      // Gắn sự kiện nút đăng ký
      document.querySelectorAll('.register-btn[data-date]').forEach(btn => {
        btn.onclick = function() {
          document.getElementById('register-modal').classList.remove('hidden');
          document.getElementById('modal-date').textContent = `Ngày: ${formatDate(this.dataset.date)}`;
          document.getElementById('modal-time').textContent = `Giờ: ${this.dataset.start} đến ${this.dataset.end}`;
          document.getElementById('modal-doctor').textContent = `Bác sĩ: ${this.dataset.doctor}`;
          document.getElementById('register-form').dataset.date = this.dataset.date;
          document.getElementById('register-form').dataset.start = this.dataset.start;
          document.getElementById('register-form').dataset.end = this.dataset.end;
          document.getElementById('register-form').dataset.doctor = this.dataset.doctor;
        };
      });
    }
    // Tạo dropdown ngày/tháng/năm cho ngày sinh
    function fillDateDropdowns() {
      const now = new Date();
      const daySel = document.getElementById('dob-day');
      const monthSel = document.getElementById('dob-month');
      const yearSel = document.getElementById('dob-year');
      daySel.innerHTML = '<option value="">Ngày</option>';
      monthSel.innerHTML = '<option value="">Tháng</option>';
      yearSel.innerHTML = '<option value="">Năm</option>';
      for(let d=1;d<=31;d++) daySel.innerHTML += `<option value="${d.toString().padStart(2,'0')}">${d}</option>`;
      for(let m=1;m<=12;m++) monthSel.innerHTML += `<option value="${m.toString().padStart(2,'0')}">${m}</option>`;
      for(let y=now.getFullYear();y>=now.getFullYear()-100;y--) yearSel.innerHTML += `<option value="${y}">${y}</option>`;
    }
    document.addEventListener('DOMContentLoaded',()=>{renderSchedule();fillDateDropdowns();});
    // Đóng popup
    document.getElementById('close-modal-btn').onclick = function() {
      document.getElementById('register-modal').classList.add('hidden');
    };
    // Gửi form đăng ký
    document.getElementById('register-form').onsubmit = async function(e) {
      e.preventDefault();
      const name = document.getElementById('patient-name').value;
      const phone = document.getElementById('patient-phone').value;
      const day = document.getElementById('dob-day').value;
      const month = document.getElementById('dob-month').value;
      const year = document.getElementById('dob-year').value;
      const dob = year && month && day ? `${year}-${month}-${day}` : '';
      const address = document.getElementById('patient-address').value;
      const reason = document.getElementById('patient-reason').value;
      const date = this.dataset.date;
      const start = this.dataset.start;
      const end = this.dataset.end;
      const doctor = this.dataset.doctor;
      if (!dob) { alert('Vui lòng chọn đầy đủ ngày sinh!'); return; }
      // Gửi về API /api/appointments (bạn có thể mở rộng backend để nhận thêm trường giờ, bác sĩ)
      const res = await fetch('/api/appointments', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name,
          phone,
          date_of_birth: dob,
          address,
          service_type: reason,
          appointment_date: `${date} ${start}`,
          doctor_name: doctor
        })
      });
      if (res.ok) {
        alert('Đăng ký thành công!');
        document.getElementById('register-modal').classList.add('hidden');
        document.getElementById('register-form').reset();
      } else {
        const data = await res.json();
        alert(data.message || 'Có lỗi khi đăng ký');
      }
    };
    </script>
</body>
</html> 